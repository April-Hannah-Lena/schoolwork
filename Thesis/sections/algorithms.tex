\section{Algorithms}

% -------------------------------------------------------------------------------------- %

\subsection{Relative Attractor}

The construction of a fundamental neighborhood $U$ for a global attractor $A$ is
relatively difficult, but the description \autoref{eq:globattr} lends to 
a natural \emph{ansatz} for its approximation using a compact subdomain $Q \subset M$. \\

\begin{definition}[Relative Global Attractor]
    Let $Q$ be compact. Then we define the \emph{attractor relative to $A$} as

    \begin{equation}
        A_Q = \bigcap\limits_{k \geq 0} f^k (Q)
    \end{equation}

\end{definition}

\begin{remark}
    It follows from the definition that the relative global attractor is a subset of the 
    global attractor.\\
\end{remark}

The idea to approximate the relative gloabl attractor is in two steps. First, we \emph{subdivide} 
each of the boxes: construct a new set $\mathcal{B}'$ by splitting each box $B \in \mathcal{B}$ 
into two (or more) smaller boxes $B_1,\ B_2$ such that $B_1 \cup B_2 = B$. 
Second, discard all those boxes whose image does not intersect with the 
previous box set. The algorithm requires a map $f$, a box set $\mathcal{B}$, and a 
predefined number of steps $n$. 

\begin{algorithm}
    \caption{Relative Attractor}
    \label{alg:relativeattractor}

    \begin{algorithmic}[1]
        %\Procedure{relative_attractor}{$f,\ \mathcal{B},\ n$}
        \State $\mathcal{B}_0 \gets \mathcal{B}$

        \For{$i = \left\{ 1,\ \dotsc,\ n \right\}$}
            \State $\mathcal{B}_i \gets$ \Call{subdivide}{$\,\mathcal{B}_{i-1}\,$}
            \State $\mathcal{B}_i \gets \mathcal{B}_i\, \cap\, f (\,\mathcal{B}_i\,)$
        \EndFor

        \State \Return $\mathcal{B}_n$ 
        %\EndProcedure
    \end{algorithmic}
\end{algorithm}

\begin{remark}\
    \begin{itemize}
        \item Optionally, the set 
        $\left\{ \mathcal{B}_0,\ \mathcal{B}_1,\ \dotsc,\ \mathcal{B}_n \right\}$
        can be returned instead. This will be true for all algorithms of this type.
        \item The precise technique for subdivision can be tuned depending on the situation. 
        In \texttt{GAIO.jl}, boxes are bisected evenly along one dimension 
        $k \in \left\{1,\ \dotsc,\ d\right\}$. The dimension $k$ along which to bisect is 
        cycled through during the steps. \\
    \end{itemize}
\end{remark}

\begin{proposition}\label{thm:cover}
    \cite*{algGAIO,subalg} Set 
    $Q_i = \bigcup_{B \in \mathcal{B}_i} B,\quad Q_\infty = \bigcap_{n \geq 1} Q_n$. 
    For all $i$ we have

    \begin{enumerate}
        \item $Q_{i+1} \subset Q_i$
        \item $A_Q \subset Q_i$ 
        \item $A_Q = Q_\infty$
    \end{enumerate}

    In particular, this shows that $Q_\infty$ is backward-invariant. 
\end{proposition}

% -------------------------------------------------------------------------------------- %

\subsection{Unstable Manifold}

From the definition of the local unstable manifold $W^u(\bar{x}, U)$ we see that the 
relative global attractor $R_Q(f)$ contains the local unstable manifold, and, provided the 
set $Q$ is sufficiently small, $W^u(\bar{x}, U)$ coincides with $R_Q(f)$. For further 
details, see \cite*{manifold, geodynbook}. Using this knowledge, we can approximate the 
global unstable manifold $W^u(\bar{x})$: 

\begin{enumerate}
    \item first, we perform an \emph{initialiation step}: replace the calculation of 
    the local unstable manifold with the calculation of the relative
    attractor for a small set $Q'$ surrounding the fixed point $\bar{x}$, using 
    \autoref{alg:relativeattractor}. 
    \item Second, we repeat the following \emph{continuation step}: map 
    the current box set forward one iteration, and note any new boxes which are hit. These 
    new boxes get added to the box set. Repeat until there are no new boxes
    added to the set. 
\end{enumerate}

\begin{algorithm}
    \caption{Continuation Step}
    \label{alg:manifold}

    \begin{algorithmic}[1]
        \State $\mathcal{B}_0 \gets \mathcal{B}$
        \State $\mathcal{B}_1 \gets \mathcal{B}$

        \While{$\mathcal{B}_1 \neq \emptyset$}
            \State $\mathcal{B}_1 \gets f(\,\mathcal{B}_1\,)$
            \State $\mathcal{B}_1 \gets \mathcal{B}_1\, \setminus\, \mathcal{B}_0$
            \State $\mathcal{B}_0 \gets \mathcal{B}_1\, \cup\, \mathcal{B}_0$
        \EndWhile

        \State \Return $\mathcal{B}_0$
    \end{algorithmic}
\end{algorithm}

\begin{proposition}
    \cite*{manifold} The algorithm in general cannot guarantee covering of the 
    entire unstable manifold, nor can it guarantee covering of the entirety of 
    $W^u(\bar{x}) \cap Q$. This is because $W^u(\bar{x})$ could in theory exit $Q$, 
    but return at another point. The algorithm can however guarantee covering 
    of the connected component of $W^u(\bar{x}) \cap Q$ which contains $\bar{x}$.
\end{proposition}
    
% -------------------------------------------------------------------------------------- %

\subsection{Chain Recurrent Set}

The algorithm to compute the chain recurrent set is first due to \cite*{chain}. The idea 
is to construct a directed graph whose vertices are the box set $\mathcal{B}$, and for 
which edges are drawn from $B_1$ to $B_2$ if $f$ maps any part of $B_1$ into $B_2$. 
Call this graph \textproc{graph}$(f, \mathcal{B})$, and call $\bar{d}$ the maximum 
\emph{diameter} of a box in our partition, ie 
$\bar{d} = \max_{\substack{B\, \in\, \mathcal{P},\\ x,\, y\, \in\, B}} d(x, y)$.\\ 

We can now ask for a subset of the vertices, for which each vertex is part of a directed cycle. 
We can equivalently characterize this set as follows:

\begin{definition}[Strongly Connected]
    For a directed graph $G = (V, E)$, a subset $H \subset V$ of vertices is called 
    \emph{strongly connected} if for all $u, v \in H$ there exist paths in both 
    directions between $v$ and $u$. Denote by \textproc{scc}$(G, v)$ the strongly connected
    subgraph which includes $v$, and by 
    \textproc{sccs}$(G) = \bigcup_{v \in V}\,$\textproc{scc}$(G, v)$ 
    the union of strongly connected components.
\end{definition}

\begin{algorithm}
    \caption{Chain Recurrrent Set}
    \label{alg:chain}

    \begin{algorithmic}[1]
        \State $\mathcal{B}_0 \gets \mathcal{B}$

        \For{$i = \left\{ 1,\ \dotsc,\ n \right\}$}
            \State $\mathcal{B}_i \gets$ \Call{subdivide}{$\,\mathcal{B}_{i-1}\,$}
            \State $G\, \gets$ \Call{graph}{$\,f,\ \mathcal{B}_{i-1}\,$}
            \State $\mathcal{B}_i \gets$ \Call{sccs}{$\,G\,$}
        \EndFor

        \State \Return $\mathcal{B}_n$
    \end{algorithmic}
\end{algorithm}

\begin{proposition}
    A cycle $\left\{ B_0,\ B_1,\ \ldots,\ B_{n-1} \right\}$ exists in $G$
    of and only if there exists an $\epsilon$-pseudoperiodic orbit 
    $\left\{ x_0,\ x_1,\ \ldots,\ x_{n-1} \right\}$ with $x_i \in B_i$.
    In particular, the vertices of $G$ form a covering of the chain recurrent set with 
    Hausdorff distance at most $\bar{d}$.
\end{proposition}

\begin{proof}
    Consider a cycle in $G$. Then by construction, for each edge $(B_i, B_{i+1})$ in the 
    cycle we can find a point $x_i \in B_i$ which gets mapped into $B_{i+1}$. Doing this for all
    edges we get a set $\left\{ x_0,\ x_1,\ \ldots,\ x_{n-1} \right\}$ which satisfies 
    $d(x_{i\, \text{mod}\, n},\ x_{i+1\, \text{mod}\, n}) \leq \bar{d}$, ie a 
    $\bar{d}$-pseudoperiodic orbit. \\

    Conversely, consider an $\epsilon$-pseudoperiodic orbit 
    $\left\{ x_0,\ x_1,\ \ldots,\ x_{n-1} \right\}$, $\epsilon \leq \bar{d}$. Then each $x_i$ is in
    a box $B_i$, and since $d(x_{i\, \text{mod}\, n},\ x_{i+1\, \text{mod}\, n}) \leq \bar{d}$, 
    there is an edge $(B_i, B_{i+1})$ in $G$. Hence 
    $\left\{ B_0,\ B_1,\ \ldots,\ B_{n-1} \right\}$ is a cycle in $G$. \\
\end{proof}

\begin{corollary}
    Proposition \ref{thm:cover} holds for \autoref{alg:chain}. For further details, 
    see \cite*{chain}.
\end{corollary}

% -------------------------------------------------------------------------------------- %

\subsection{Invariant Measure}

We shift focus to approximating invariant measures for the Perron-Frobenius operator $P$.
For simplicity we will work only with measures absolutely continuous with respect to the 
Lebesque measure on $M$, ie measures for which there exists a \emph{kernel} $k$ with 

\begin{equation}
    \label{eq:kernel}
    p(x, A) = \int_A k(x, y)\, dy.
\end{equation}

In this case we can define $P: L^1 \to L^1$ as 

\begin{equation}
    (P \phi)(y) = \int \phi (x)\, k(x, y)\, dx.
\end{equation}

Note that a fixed point $\phi$ of P is the density of an invariant measure 
$\mu_\phi (A) = \int_A\, \phi(x)\, dx$. \\

We will use a Galerkin approximation for $P$ which maintains the eigenvalues and cyclic 
behavior of $P$. To do this, we project to a subspace 
$\chi_{\mathcal{P}}$ generated by the basis $\left\{ \chi_B\ \vert\ B \in \mathcal{P} \right\}$ 
of indicator functions on the boxes of our partition. Further, enumerate the partition 
$\mathcal{P} = \left\{ B_1,\ B_2,\ \ldots,\ B_n \right\}$ and define the matrix 

\begin{equation}
    \label{eq:pij}
    P_{ij} = \frac{\mathcal{L}\left(B_j \cap f(B_i)\right)}{\mathcal{L}(B_j)}, 
    \quad i,\, j = 1, \ldots, n,
\end{equation}

as well as a linear operator $Q_n P : \chi_{\mathcal{P}} \to \chi_{\mathcal{P}}$ as 
the linear extension of 

\begin{equation}
    \label{eq:qnp}
    (Q_n P)\, \chi_{B_i} = \sum_{j = 1}^n P_{ij}\, \chi_{B_j}, \quad i = 1, \ldots, n.
\end{equation}

To realize this approximation, we need to calculate $P_{ij}$. For this there are two 
techniques discussed in \cite*{algGAIO}. The simpler of the two techniques is a 
Monte-Carlo approach. Namely, we choose a fixed number $r$ of test points in 
$B_i$, and set $P_{ij}$ as the fraction of test points which land in $B_j$:

\begin{algorithm}
    \caption{Invariant Measure}
    \label{alg:measure}
    \begin{spacing}{1.2}
        \begin{algorithmic}[1]

            \For{$i,j \in \left\{ 1,\ \ldots,\ n \right\}$}
                \State $p\ \ \gets $ Choose $\left\{ p_1,\ \ldots,\ p_r \right\}$ randomly from a uniform distribution on $B_i$
                \State $P_{ij} \gets \left. |\ B_j \cap f(p)\ | \ \middle/\ |\ p\ | \right.$
            \EndFor
    
            \State $v \gets $ Find a fixed point of $P$
            \label{alg:measure:fix}
            \State $\phi_n \gets \sum_{i=1}^n\: v_i\, \chi_{B_i}$
            \State \Return $\phi_n$
        \end{algorithmic}
    \end{spacing}
\end{algorithm}

\begin{remark}\ 
    \begin{itemize}
        \item In practice the Monte-Carlo test points are only generated once from the unit cube 
        $[-1,1]^d$, and then scaled to fit inside the box $B_i$.
        \item Line~\ref{alg:measure:fix} is acheived using the Fortran library ARPACK \cite*{ARPACK}, 
        which has been wrapped in julia by the creators of Arpack.jl \cite*{Arpack.jl}. Recently, the 
        underlying algorithm (an implicitly restarted Arnoldi method) has been 
        implemented in pure julia under the package name ArnoldiMethod.jl \cite*{ArnoldiMethod.jl}. \\
    \end{itemize}
\end{remark}

\begin{proposition}
    \cite*{lasota}
    Let $p(x, A)$ be a transition function with globally lipschitz continuous kernel $k$. 
    Then the operator $P$ is compact. Further, if $k$ is strictly positive, $P$ has
    a unique fixed point $\phi \in L^1$. 
\end{proposition}

\begin{proposition}
    \cite*{attr, measure, algGAIO, perturbationsbook, perturbationsart} 
    Suppose the transition function $p = p_\epsilon$ converges in the weak* sense to the 
    dirac measure, ie 

    \begin{equation}
        p_\epsilon (x, \cdot) \overset{*}{\rightharpoonup} \delta_{f(x)} 
        \quad\text{as}\quad \epsilon \to 0.
    \end{equation}

    (An example of this would be Ex. \ref{ex:q} for a sequence of partitions 
    $\mathcal{P}_\epsilon$ with diameters
    $\bar{d}_\epsilon = \max_{\substack{B\, \in\, \mathcal{P}_\epsilon,\\ x,\, y\, \in\, B}} d(x, y) \to 0$).
    Suppose further that the diffeomorphism $f$ has a hyperbolic attracting set $A$ with
    and an open set $U \supset A$ such that for the kernels we have

    \begin{equation}
        k_\epsilon (f(x), y) = 0 \quad\text{if}\quad x \in \overline{U},\ y \notin U.
    \end{equation}

    Let $P_\epsilon$ be the Perron-Frobenius operator for the transition function 
    $p_\epsilon$. Then there exist unique fixed points $\phi_\epsilon^n$ of $Q_n P_\epsilon$, 
    and the sequence of fixed points converge to the fixed point $\phi$ of the true 
    operator $P$, ie

    \begin{equation}
        \phi_\epsilon^n \to \phi 
        \quad\text{as}\quad n \to \infty,\ \epsilon \to 0.
    \end{equation}
\end{proposition}

% -------------------------------------------------------------------------------------- %

\subsection{Almost Invariant Sets (and Cycles)}

Our final algorithm is quite analogous to the algorithm for invariant measures of $P$. We 
begin with a theorem about the convergence our discretized operator.

\begin{theorem}
    \label{thm:QnP}
    \cite*{attr}
    Suppose our transition function $p$ has a kernel $k$ (see \autoref{eq:kernel}) which 
    satisfies 

    \begin{equation}
        \iint |k(x, y)|^2\ dx\,dy < \infty. 
    \end{equation}

    Then the Frobenius Perron operator $P : L^2 \to L^2$ is compact. Further $Q_n P$ 
    converges strongly to $P$ in the operator norm on $L^2$, ie

    \begin{equation}
        \|\, Q_n P - P \,\| \to 0 \quad \text{as} \quad n \to \infty .
    \end{equation}

\end{theorem}

Assume now that $Q_n P$ has an eigenvalue $1$ with multiplicity $2$. Then 
as described in \cite*{algGAIO}: by the above 
theorem, the eigenvalue will split into two simple eigenvalues, one of which will move away  
from $1$ (the other will stay at unity since $Q_n P$ is column stochastic). If we now find 
this eigenvector $\phi_n$, then (again by the above theorem and the continuity of $P$) 
the positive and negative regions of $\phi_n$ will converge to the sets $E^+$ and $E^-$ 
from Theorem \ref{thm:almost}. That is, they are almost invariant. 

\begin{algorithm}
    \caption{Almost Invariant Sets}
    \label{alg:almost}
    \begin{spacing}{1.2}
        \begin{algorithmic}[1]

            \For{$i,j \in \left\{ 1,\ \ldots,\ n \right\}$}
                \State $p\ \ \gets $ Choose $\left\{ p_1,\ \ldots,\ p_r \right\}$ randomly from a uniform distribution on $B_i$
                \State $P_{ij} \gets \left. |\ B_j \cap f(p)\ | \ \middle/\ |\ p\ | \right.$
            \EndFor
    
            \State $v \gets $ Find an eigenvector to the second largest eigenvalue of $P$
            \label{alg:almost:fix}
            \State $E^+ \gets \cup \left\{ B_i\ \vert\ v_i \geq 0 \right\}$
            \State $E^- \gets \cup \left\{ B_i\ \vert\ v_i < 0 \right\}$
            \State \Return $E^+,\ E^-$
        \end{algorithmic}
    \end{spacing}
\end{algorithm}

\begin{remark}
    The algorithm can also be used to find almost invariant cycles. In this case line 
    \ref{alg:almost:fix} simply needs to be changed to find an eigenvector near $-1$.
\end{remark} 

% -------------------------------------------------------------------------------------- %
